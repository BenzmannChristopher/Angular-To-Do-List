<div class="todo-container">
  <div class="todo-header">
    <h1>Meine Aufgaben</h1>
  </div>

  <!-- Add Task Section -->
  <div class="add-task-section">
    <form (ngSubmit)="addTodo()">
      <div class="input-group">
        <input 
          type="text" 
          [(ngModel)]="newTodo" 
          name="newTodo" 
          placeholder="Neue Aufgabe hinzufÃ¼gen..." 
          required>
        <button type="submit">HinzufÃ¼gen</button>
      </div>
      
      <div class="task-options">
        <div class="date-notification-row">
          <div class="date-option">
            <label for="dueDate">FÃ¤lligkeitsdatum:</label>
            <input 
              type="datetime-local" 
              id="dueDate" 
              [(ngModel)]="newTodoDueDate" 
              name="dueDate"
              class="modern-date-input">
          </div>
          
          <div class="notification-option">
            <label for="notification">
              <i class="notification-icon">ðŸ””</i>
              Benachrichtigung:
            </label>
            <div class="notification-controls">
              <input 
                type="checkbox" 
                id="notification" 
                [(ngModel)]="newTodoHasNotification" 
                name="notification"
                [disabled]="!newTodoDueDate"
                class="notification-checkbox">
              <button 
                *ngIf="isBrowser && !notificationPermissionGranted" 
                (click)="requestNotificationPermission()" 
                type="button"
                class="notification-permission-btn">
                Benachrichtigungen erlauben
              </button>
            </div>
          </div>
        </div>

        <!-- Category Selection -->
        <div class="category-selection">
          <label>Kategorien:</label>
          <div class="category-chips">
            <div 
              *ngFor="let category of availableCategories" 
              class="category-chip" 
              [class.selected]="isCategorySelected(category)"
              (click)="toggleCategory(category)">
              {{ category }}
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <!-- Filter Section -->
  <div class="filter-section">
    <div class="todo-status">
      <p>{{ getOpenTodosCount() }} offene Aufgaben</p>
      <button class="clear-btn" (click)="clearCompletedTodos()">Erledigte lÃ¶schen</button>
    </div>
    
    <div class="filter-navbar">
      <button 
        [class.active]="filter === 'all'" 
        (click)="changeFilter('all')">
        Alle
      </button>
      <button 
        [class.active]="filter === 'active'" 
        (click)="changeFilter('active')">
        Offen
      </button>
      <button 
        [class.active]="filter === 'done'" 
        (click)="changeFilter('done')">
        Erledigt
      </button>
    </div>
  </div>

  <!-- Category Filter -->
  <div class="category-filter">
    <button 
      class="category-filter-chip" 
      [class.active]="categoryFilter === null"
      (click)="filterByCategory(null)">
      Alle Kategorien
    </button>
    <button 
      *ngFor="let category of availableCategories" 
      class="category-filter-chip"
      [class.active]="categoryFilter === category"
      (click)="filterByCategory(category)">
      {{ category }}
    </button>
  </div>

  <!-- Todos List -->
  <div class="trello-board" *ngIf="todos.length > 0">
    <div class="card-container">
      <div class="trello-card" *ngFor="let todo of filteredTodos()" [class.completed-card]="todo.completed">
        <div class="card-header" [class.completed]="todo.completed">
          <div class="completion-status">
            <div class="status-indicator" [class.done]="todo.completed"></div>
            <span class="status-text">{{ todo.completed ? 'Erledigt' : 'Offen' }}</span>
          </div>
          <button class="delete-btn" (click)="removeTodo(todo.id)">âœ•</button>
        </div>
        
        <div class="card-content">
          <p [class.completed]="todo.completed">{{ todo.title }}</p>
          
          <!-- Categories Display -->
          <div class="todo-categories" *ngIf="todo.categories && todo.categories.length">
            <div class="categories-container">
              <div 
                *ngFor="let cat of todo.categories" 
                class="category-badge">
                {{ cat }}
              </div>
            </div>
          </div>

          <!-- Category Editor -->
          <div class="category-editor">
            <label>Kategorien bearbeiten:</label>
            <div class="edit-category-chips">
              <div 
                *ngFor="let category of availableCategories" 
                class="category-chip small" 
                [class.selected]="hasTodoCategory(todo, category)"
                (click)="toggleTodoCategory(todo, category)">
                {{ category }}
              </div>
            </div>
          </div>
          
          <!-- Due Date and Notification Controls -->
          <div class="due-date-notification-container" *ngIf="todo.dueDate">
            <div class="due-date" [class.overdue]="isOverdue(todo)">
              <span class="due-date-label">FÃ¤llig am:</span>
              <span class="due-date-value">{{ formatDate(todo.dueDate) }}</span>
              <div class="date-controls">
                <input 
                  type="datetime-local" 
                  [ngModel]="todo.dueDate | date:'yyyy-MM-ddTHH:mm'" 
                  (ngModelChange)="updateDueDate(todo)"
                  name="todoDate"
                  class="modern-date-input">
              </div>
            </div>
            
            <!-- Notification Toggle -->
            <div class="notification-toggle" *ngIf="isBrowser">
              <label class="notification-label">
                <i class="notification-icon">ðŸ””</i>
                <input 
                  type="checkbox" 
                  [checked]="todo.hasNotification" 
                  (change)="toggleNotification(todo)"
                  [disabled]="!todo.dueDate"
                  class="notification-checkbox">
                <span>Benachrichtigung</span>
              </label>
            </div>
          </div>
        </div>
        
        <div class="card-footer">
          <button class="toggle-btn" (click)="toggleCompleted(todo.id)">
            {{ todo.completed ? 'Wiederherstellen' : 'Als erledigt markieren' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="todos.length === 0" class="empty-state">
    <p>Keine Aufgaben vorhanden. FÃ¼ge eine neue Aufgabe hinzu!</p>
  </div>
</div>
  